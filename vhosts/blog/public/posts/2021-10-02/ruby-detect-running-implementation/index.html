<!DOCTYPE html>
<html lang="ja-JP">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="nsfisis">
    <meta name="copyright" content="&copy; 2021 nsfisis">
    <meta name="description" content="Ruby には複数の実装があるが、自身を実行している処理系の種類をスクリプト上からどのように判定すればよいだろうか。">
    <meta name="keywords" content="Ruby">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <title>【Ruby】 自身を実行している処理系の種類を判定する | REPL: Rest-Eat-Program Loop</title>
    <link rel="stylesheet" href="/style.css?h=6a3b357ff2e26410fe3875b6b5617433">
    <link rel="stylesheet" href="/hl.css?h=340e65ffd5c17713efc9107c06304f7b">
  </head>
  <body class="single">
    <header class="header">
      <nav class="nav">
        <ul>
          <li>
            <a href="/">REPL: Rest-Eat-Program Loop</a>
          </li>
          <li>
            <a href="/about/">About</a>
          </li>
          <li>
            <a href="/posts/">Posts</a>
          </li>
          <li>
            <a href="/slides/">Slides</a>
          </li>
          <li>
            <a href="/tags/">Tags</a>
          </li>
        </ul>
      </nav>
    </header>
    <main class="main">
      <article class="post-single">
        <header class="post-header">
          <h1 class="post-title">【Ruby】 自身を実行している処理系の種類を判定する</h1>
          <ul class="post-tags">
            <li class="tag">
              <a href="/tags/ruby/">Ruby</a>
            </li>
          </ul>
        </header>
        <div class="post-content">
          <section>
            <h2 id="changelog">更新履歴</h2>
            <ol>
              <li class="revision">
                <time datetime="2021-10-02">2021-10-02</time>: Qiita から移植
              </li>
            </ol>
          </section>
          <div class="admonition">
            <div class="admonition-label">
              NOTE
            </div>
            <div class="admonition-content">
               この記事は Qiita から移植してきたものです。 元 URL: <a href="https://qiita.com/nsfisis/items/74d7ffeeebc51b20d791">https://qiita.com/nsfisis/items/74d7ffeeebc51b20d791</a>
            </div>
          </div>
           
          <p>
             Ruby という言語には複数の実装があるが、それらをスクリプト上からどのようにして programmatically に見分ければよいだろうか。 
          </p>
           
          <p>
            <code>Object</code> クラスに定義されている <code>RUBY_ENGINE</code> という定数がこの用途に使える。 
          </p>
           
          <p>
             参考: <a href="https://docs.ruby-lang.org/ja/latest/method/Object/c/RUBY_ENGINE.html">Object::RUBY_ENGINE</a>
          </p>
           
          <p>
             上記ページの例から引用する: 
          </p>
           
          <pre class="highlight" language="shell-session"><code>$ ruby-1.9.1 -ve &apos;p RUBY_ENGINE&apos;
ruby 1.9.1p0 (2009-03-04 revision 22762) [x86_64-linux]
&quot;ruby&quot;
$ jruby -ve &apos;p RUBY_ENGINE&apos;
jruby 1.2.0 (ruby 1.8.6 patchlevel 287) (2009-03-16 rev 9419) [i386-java]
&quot;jruby&quot;</code></pre>
           
          <p>
             それぞれの処理系がどのような値を返すかだが、stack overflow に良い質問と回答があった。 
          </p>
           
          <p>
            <a href="https://stackoverflow.com/a/9894232">What values for RUBY_ENGINE correspond to which Ruby implementations?</a> より引用: 
          </p>
           
          <blockquote>
            <table>
              <thead>
                <tr>
                  <td>
                    RUBY_ENGINE
                  </td>
                   
                  <td>
                    Implementation
                  </td>
                </tr>
              </thead>
               
              <tbody>
                <tr>
                  <td>
                    &lt;undefined&gt;
                  </td>
                   
                  <td>
                    MRI &lt; 1.9
                  </td>
                </tr>
                 
                <tr>
                  <td>
                    `ruby&apos;
                  </td>
                   
                  <td>
                    MRI &gt;= 1.9 or REE
                  </td>
                </tr>
                 
                <tr>
                  <td>
                    `jruby&apos;
                  </td>
                   
                  <td>
                    JRuby
                  </td>
                </tr>
                 
                <tr>
                  <td>
                    `macruby&apos;
                  </td>
                   
                  <td>
                    MacRuby
                  </td>
                </tr>
                 
                <tr>
                  <td>
                    `rbx&apos;
                  </td>
                   
                  <td>
                    Rubinius
                  </td>
                </tr>
                 
                <tr>
                  <td>
                    `maglev&apos;
                  </td>
                   
                  <td>
                    MagLev
                  </td>
                </tr>
                 
                <tr>
                  <td>
                    `ironruby&apos;
                  </td>
                   
                  <td>
                    IronRuby
                  </td>
                </tr>
                 
                <tr>
                  <td>
                    `cardinal&apos;
                  </td>
                   
                  <td>
                    Cardinal
                  </td>
                </tr>
              </tbody>
            </table>
          </blockquote>
           
          <p>
             なお、この質問・回答は 2014年になされたものであり、値は変わっている可能性がある。MRI (aka CRuby) については執筆時現在 (2020/12/8) も <code>&apos;ruby&apos;</code> が返ってくることを確認済み。 
          </p>
           
          <p>
             この表にない主要な処理系として、https://mruby.org[mruby] は <code>&apos;mruby&apos;</code> を返す。 
          </p>
           
          <p>
            <a href="https://github.com/mruby/mruby/blob/ed29d74bfd95362eaeb946fcf7e865d80346b62b/include/mruby/version.h#L32-L35">mruby 該当部分のソース</a> より引用: 
          </p>
           
          <pre class="highlight" language="c"><code class="highlight"><span class="hljs-comment">/*
* Ruby engine.
*/</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> MRUBY_RUBY_ENGINE  <span class="hljs-string">&quot;mruby&quot;</span></span></code></pre>
        </div>
      </article>
    </main>
    <footer class="footer">
      &copy; 2021 nsfisis
    </footer>
  </body>
</html>
